/*! satnet-ng 15-12-2015 rtubiopa@calpoly.edu Apache-2.0*/
angular.module("snBroadcasterServices",["snPushServices"]).service("broadcaster",["$rootScope","$log","satnetPush",function(a,b,c){this.GS_ADDED_EVENT="gs.added",this.GS_REMOVED_EVENT="gs.removed",this.GS_UPDATED_EVENT="gs.updated",this.GS_AVAILABLE_ADDED_EVENT="gs.available.added",this.GS_AVAILABLE_REMOVED_EVENT="gs.available.removed",this.GS_AVAILABLE_UPDATED_EVENT="gs.available.updated",this.PASSES_UPDATED="passes.updated",this.LEOP_GSS_UPDATED_EVENT="leop.gss.updated",this.LEOP_GS_ASSIGNED_EVENT="leop.gs.assigned",this.LEOP_GS_RELEASED_EVENT="leop.gs.released",this.LEOP_UPDATED_EVENT="leop.updated",this.LEOP_FRAME_RX_EVENT="leop.frame.rx",this.KEEP_ALIVE_EVENT="KEEP_ALIVE",this.gsAvailableAddedInternal=function(b){a.$broadcast("gs.available.added",b)},this.gsAdded=function(b){a.$broadcast(this.GS_ADDED_EVENT,b)},this.gsRemoved=function(b){a.$broadcast(this.GS_REMOVED_EVENT,b)},this.gsUpdated=function(b){a.$broadcast(this.GS_UPDATED_EVENT,b)},this.SC_ADDED_EVENT="sc.added",this.SC_REMOVED_EVENT="sc.removed",this.SC_UPDATED_EVENT="sc.updated",this.scAdded=function(b){a.$broadcast(this.SC_ADDED_EVENT,b)},this.scRemoved=function(b){a.$broadcast(this.SC_REMOVED_EVENT,b)},this.scUpdated=function(b){a.$broadcast(this.SC_UPDATED_EVENT,b)},this.gsAvailableAdded=function(b){a.$broadcast("gs.available.added",b.identifier)},this.gsAvailableRemoved=function(b){a.$broadcast("gs.available.removed",b.identifier),a.$broadcast("passes.updated",{})},this.gsAvailableUpdated=function(b){a.$broadcast("gs.available.updated",b.identifier),a.$broadcast("passes.updated",{})},this.passesUpdated=function(){a.$broadcast("passes.updated",{})},this.scGtUpdated=function(b){a.$broadcast("sc.updated",b.identifier)},this.leopGssUpdated=function(b){a.leop_id===b.identifier&&a.$broadcast("leop.gss.updated",b)},this.leopGsAssigned=function(b){a.leop_id===b.launch_id&&a.$broadcast("leop.gs.assigned",b.groundstation_id)},this.leopGsReleased=function(b){a.leop_id===b.launch_id&&a.$broadcast("leop.gs.released",b.groundstation_id)},this.leopUpdated=function(b){a.leop_id===b.identifier&&a.$broadcast("leop.updated",b)},this.leopUfoIdentified=function(b){a.leop_id===b.launch_id&&(a.$broadcast("sc.added",b.spacecraft_id),a.$broadcast("passes.updated",{}))},this.leopUfoUpdated=function(b){a.leop_id===b.launch_id&&(a.$broadcast("sc.updated",b.spacecraft_id),a.$broadcast("passes.updated",{}))},this.leopUfoForgot=function(b){a.leop_id===b.launch_id&&(a.$broadcast("sc.removed",b.spacecraft_id),a.$broadcast("passes.updated",{}))},this.leopSCUpdated=function(b){a.leop_id===b.launch_id&&(a.$broadcast("sc.updated",b.launch_sc_id),a.$broadcast("passes.updated",{}))},this.leopFrameReceived=function(b){a.$broadcast("leop.frame.rx",b.frame)},this.keepAliveReceived=function(c){a.$broadcast("KEEP_ALIVE",{}),b.log("ALIVE! data = "+JSON.stringify(c))},c.bind(c.EVENTS_CHANNEL,c.GS_ADDED_EVENT,this.gsAvailableAdded,this),c.bind(c.EVENTS_CHANNEL,c.GS_REMOVED_EVENT,this.gsAvailableRemoved,this),c.bind(c.EVENTS_CHANNEL,c.GS_UPDATED_EVENT,this.gsAvailableUpdated,this),c.bind(c.SIMULATION_CHANNEL,c.PASSES_UPDATED_EVENT,this.passesUpdated,this),c.bind(c.SIMULATION_CHANNEL,c.GT_UPDATED_EVENT,this.scGtUpdated,this),c.bind(c.LEOP_CHANNEL,c.LEOP_UPDATED_EVENT,this.leopUpdated,this),c.bind(c.LEOP_CHANNEL,c.LEOP_GSS_UPDATED_EVENT,this.leopGssUpdated,this),c.bind(c.LEOP_CHANNEL,c.LEOP_GS_ASSIGNED_EVENT,this.leopGsAssigned,this),c.bind(c.LEOP_CHANNEL,c.LEOP_GS_RELEASED_EVENT,this.leopGsReleased,this),c.bind(c.LEOP_CHANNEL,c.LEOP_UFO_IDENTIFIED_EVENT,this.leopUfoIdentified,this),c.bind(c.LEOP_CHANNEL,c.LEOP_UFO_UPDATED_EVENT,this.leopUfoUpdated,this),c.bind(c.LEOP_CHANNEL,c.LEOP_UFO_FORGOTTEN_EVENT,this.leopUfoForgot,this),c.bind(c.LEOP_CHANNEL,c.LEOP_SC_UPDATED_EVENT,this.leopSCUpdated,this),c.bind(c.LEOP_DOWNLINK_CHANNEL,c.FRAME_EVENT,this.leopFrameReceived,this),c.bind(c.NETWORK_EVENTS_CHANNEL,c.KEEP_ALIVE,this.keepAliveReceived,this)}]),angular.module("snCelestrakServices",[]).service("celestrak",[function(){this.CELESTRAK_URL_BASE="http://celestrak.com/NORAD/elements/",this.CELESTRAK_SECTION_1="Weather & Earth Resources",this.CELESTRAK_WEATHER=this.CELESTRAK_URL_BASE+"weather.txt",this.CELESTRAK_NOAA=this.CELESTRAK_URL_BASE+"noaa.txt",this.CELESTRAK_GOES=this.CELESTRAK_URL_BASE+"goes.txt",this.CELESTRAK_EARTH_RESOURCES=this.CELESTRAK_URL_BASE+"resource.txt",this.CELESTRAK_SARSAT=this.CELESTRAK_URL_BASE+"sarsat.txt",this.CELESTRAK_DISASTER_MONITORING=this.CELESTRAK_URL_BASE+"dmc.txt",this.CELESTRAK_TRACKING_DATA_RELAY=this.CELESTRAK_URL_BASE+"tdrss.txt",this.CELESTRAK_ARGOS=this.CELESTRAK_URL_BASE+"argos.txt",this.CELESTRAK_SECTION_2="Communications",this.CELESTRAK_GEOSTATIONARY=this.CELESTRAK_URL_BASE+"geo.txt",this.CELESTRAK_INTELSAT=this.CELESTRAK_URL_BASE+"intelsat.txt",this.CELESTRAK_GORIZONT=this.CELESTRAK_URL_BASE+"gorizont.txt",this.CELESTRAK_RADUGA=this.CELESTRAK_URL_BASE+"raduga.txt",this.CELESTRAK_MOLNIYA=this.CELESTRAK_URL_BASE+"molniya.txt",this.CELESTRAK_IRIDIUM=this.CELESTRAK_URL_BASE+"iridium.txt",this.CELESTRAK_ORBCOMM=this.CELESTRAK_URL_BASE+"orbcomm.txt",this.CELESTRAK_GLOBALSTAR=this.CELESTRAK_URL_BASE+"globalstar.txt",this.CELESTRAK_AMATEUR_RADIO=this.CELESTRAK_URL_BASE+"amateur.txt",this.CELESTRAK_EXPERIMENTAL=this.CELESTRAK_URL_BASE+"x-comm.txt",this.CELESTRAK_COMMS_OTHER=this.CELESTRAK_URL_BASE+"other-comm.txt",this.CELESTRAK_SECTION_3="Navigation",this.CELESTRAK_GPS_OPERATIONAL=this.CELESTRAK_URL_BASE+"gps-ops.txt",this.CELESTRAK_GLONASS_OPERATIONAL=this.CELESTRAK_URL_BASE+"glo-ops.txt",this.CELESTRAK_GALILEO=this.CELESTRAK_URL_BASE+"galileo.txt",this.CELESTRAK_BEIDOU=this.CELESTRAK_URL_BASE+"beidou.txt",this.CELESTRAK_SATELLITE_AUGMENTATION=this.CELESTRAK_URL_BASE+"sbas.txt",this.CELESTRAK_NNSS=this.CELESTRAK_URL_BASE+"nnss.txt",this.CELESTRAK_RUSSIAN_LEO_NAVIGATION=this.CELESTRAK_URL_BASE+"musson.txt",this.CELESTRAK_SECTION_4="Scientific",this.CELESTRAK_SPACE_EARTH_SCIENCE=this.CELESTRAK_URL_BASE+"science.txt",this.CELESTRAK_GEODETIC=this.CELESTRAK_URL_BASE+"geodetic.txt",this.CELESTRAK_ENGINEERING=this.CELESTRAK_URL_BASE+"engineering.txt",this.CELESTRAK_EDUCATION=this.CELESTRAK_URL_BASE+"education.txt",this.CELESTRAK_SECTION_5="Miscellaneous",this.CELESTRAK_MILITARY=this.CELESTRAK_URL_BASE+"military.txt",this.CELESTRAK_RADAR_CALLIBRATION=this.CELESTRAK_URL_BASE+"radar.txt",this.CELESTRAK_CUBESATS=this.CELESTRAK_URL_BASE+"cubesat.txt",this.CELESTRAK_OTHER=this.CELESTRAK_URL_BASE+"other.txt",this.CELESTRAK_RESOURCES={Weather:this.CELESTRAK_WEATHER,NOAA:this.CELESTRAK_NOAA,GOES:this.CELESTRAK_GOES,"Earth Resources":this.CELESTRAK_EARTH_RESOURCES,SARSAT:this.CELESTRAK_SARSAT,"Disaster Monitoring":this.CELESTRAK_DISASTER_MONITORING,"Tracking & Data Relay":this.CELESTRAK_TRACKING_DATA_RELAY,ARGOS:this.CELESTRAK_ARGOS,Geostationary:this.CELESTRAK_GEOSTATIONARY,Intelsat:this.CELESTRAK_INTELSAT,Gorizont:this.CELESTRAK_GORIZONT,Raduga:this.CELESTRAK_RADUGA,Molniya:this.CELESTRAK_MOLNIYA,Iridium:this.CELESTRAK_IRIDIUM,Orbcomm:this.CELESTRAK_ORBCOMM,Globalstar:this.CELESTRAK_GLOBALSTAR,"Amateur Radio":this.CELESTRAK_AMATEUR_RADIO,Experimental:this.CELESTRAK_EXPERIMENTAL,Others:this.CELESTRAK_COMMS_OTHER,"GPS Operational":this.CELESTRAK_GPS_OPERATIONAL,"Glonass Operational":this.CELESTRAK_GLONASS_OPERATIONAL,Galileo:this.CELESTRAK_GALILEO,Beidou:this.CELESTRAK_BEIDOU,"Satellite-based Augmentation System":this.CELESTRAK_SATELLITE_AUGMENTATION,"Navy Navigation Satellite System":this.CELESTRAK_NNSS,"Russian LEO Navigation":this.CELESTRAK_RUSSIAN_LEO_NAVIGATION,"Space & Earth Science":this.CELESTRAK_SPACE_EARTH_SCIENCE,Geodetic:this.CELESTRAK_GEODETIC,Engineering:this.CELESTRAK_ENGINEERING,Education:this.CELESTRAK_EDUCATION,Military:this.CELESTRAK_MILITARY,"Radar Callibration":this.CELESTRAK_RADAR_CALLIBRATION,CubeSats:this.CELESTRAK_CUBESATS,Other:this.CELESTRAK_OTHER},this.CELESTRAK_SELECT_SECTIONS=[{section:this.CELESTRAK_SECTION_1,subsection:"Weather"},{section:this.CELESTRAK_SECTION_1,subsection:"NOAA"},{section:this.CELESTRAK_SECTION_1,subsection:"GOES"},{section:this.CELESTRAK_SECTION_1,subsection:"Earth Resources"},{section:this.CELESTRAK_SECTION_1,subsection:"SARSAT"},{section:this.CELESTRAK_SECTION_1,subsection:"Disaster Monitoring"},{section:this.CELESTRAK_SECTION_1,subsection:"Tracking & Data Relay"},{section:this.CELESTRAK_SECTION_1,subsection:"ARGOS"},{section:this.CELESTRAK_SECTION_2,subsection:"Geostationary"},{section:this.CELESTRAK_SECTION_2,subsection:"Intelsat"},{section:this.CELESTRAK_SECTION_2,subsection:"Gorizont"},{section:this.CELESTRAK_SECTION_2,subsection:"Raduga"},{section:this.CELESTRAK_SECTION_2,subsection:"Molniya"},{section:this.CELESTRAK_SECTION_2,subsection:"Iridium"},{section:this.CELESTRAK_SECTION_2,subsection:"Orbcomm"},{section:this.CELESTRAK_SECTION_2,subsection:"Globalstar"},{section:this.CELESTRAK_SECTION_2,subsection:"Amateur Radio"},{section:this.CELESTRAK_SECTION_2,subsection:"Experimental"},{section:this.CELESTRAK_SECTION_2,subsection:"Others"},{section:this.CELESTRAK_SECTION_3,subsection:"GPS Operational"},{section:this.CELESTRAK_SECTION_3,subsection:"Glonass Operational"},{section:this.CELESTRAK_SECTION_3,subsection:"Galileo"},{section:this.CELESTRAK_SECTION_3,subsection:"Beidou"},{section:this.CELESTRAK_SECTION_3,subsection:"Satellite-based Augmentation System"},{section:this.CELESTRAK_SECTION_3,subsection:"Navy Navigation Satellite System"},{section:this.CELESTRAK_SECTION_3,subsection:"Russian LEO Navigation"},{section:this.CELESTRAK_SECTION_4,subsection:"Space & Earth Science"},{section:this.CELESTRAK_SECTION_4,subsection:"Geodetic"},{section:this.CELESTRAK_SECTION_4,subsection:"Engineering"},{section:this.CELESTRAK_SECTION_4,subsection:"Education"},{section:this.CELESTRAK_SECTION_5,subsection:"Military"},{section:this.CELESTRAK_SECTION_5,subsection:"Radar Callibration"},{section:this.CELESTRAK_SECTION_5,subsection:"CubeSats"},{section:this.CELESTRAK_SECTION_5,subsection:"Other"}]}]),angular.module("snControllers",["ngMaterial"]).service("snDialog",["$log","$mdDialog","$mdToast",function(a,b,c){this.success=function(d,e,f,g){var h="Succesfull operation <"+d+"> over id = <"+e+">";a.info("@success, message = "+h+", response = "+JSON.stringify(f)),c.show(c.simple().content(h)),g&&b.show(g)},this.exception=function(d,e,f){var g="Error while doing operation <"+d+"> over id = <"+e+">";a.error("@exception, cause: "+JSON.stringify(f)),c.show(c.simple().content(g)),b.hide()}}]),angular.module("snPushServices",["pusher-angular"]).service("satnetPush",["$log","$pusher",function(a,b){"use strict";this._API_KEY="79bee37791b6c60f3e56",this._client=null,this._service=null,this.LEOP_DOWNLINK_CHANNEL="leop.downlink.ch",this.EVENTS_CHANNEL="configuration.events.ch",this.NETWORK_EVENTS_CHANNEL="network.events.ch",this.SIMULATION_CHANNEL="simulation.events.ch",this.LEOP_CHANNEL="leop.events.ch",this.KEEP_ALIVE="keep_alive",this.FRAME_EVENT="frameEv",this.GS_ADDED_EVENT="gsAddedEv",this.GS_REMOVED_EVENT="gsRemovedEv",this.GS_UPDATED_EVENT="gsUpdatedEv",this.PASSES_UPDATED_EVENT="passesUpdatedEv",this.GT_UPDATED_EVENT="groundtrackUpdatedEv",this.LEOP_GSS_UPDATED_EVENT="leopGSsUpdatedEv",this.LEOP_GS_ASSIGNED_EVENT="leopGSAssignedEv",this.LEOP_GS_RELEASED_EVENT="leopGSReleasedEv",this.LEOP_UPDATED_EVENT="leopUpdatedEv",this.LEOP_UFO_IDENTIFIED_EVENT="leopUFOIdentifiedEv",this.LEOP_UFO_FORGOTTEN_EVENT="leopUFOForgottenEv",this.LEOP_SC_UPDATED_EVENT="leopSCUpdatedEv",this._channel_names=[this.LEOP_DOWNLINK_CHANNEL,this.EVENTS_CHANNEL,this.SIMULATION_CHANNEL,this.NETWORK_EVENTS_CHANNEL,this.LEOP_CHANNEL],this._initData=function(){this._client=new Pusher(this._API_KEY,{encrypted:!0}),this._service=b(this._client),this._service.connection.bind("state_change",this._logConnection),a.info("[push] pusher.com service initialized!"),this._subscribeChannels()},this._logConnection=function(b){a.info("[push] State connection change, states = "+JSON.stringify(b))},this._subscribeChannels=function(){var b=this;angular.forEach(this._channel_names,function(c){b._service.subscribe(c),a.info("[push] Subscribed to channel <"+c+">")})},this.bind=function(a,b,c){if(!this._service.allChannels().hasOwnProperty(a))throw"Not subscribed to this channel, name = <"+a+">";this._service.channel(a).bind(b,c)},this.bindFrameReceived=function(a){this.bind(this.LEOP_DOWNLINK_CHANNEL,this.FRAME_EVENT,a,this)},this._initData()}]),angular.module("snJRPCServices",["jsonrpc","ngCookies"]).run(["$http","$cookies",function(a,b){a.defaults.headers.post["X-CSRFToken"]=b.csrftoken}]).constant("RPC_GS_PREFIX","gs").constant("RPC_SC_PREFIX","sc").constant("TEST_PORT",8e3).service("satnetRPC",["jsonrpc","$location","$log","$q","$http","TEST_PORT",function(a,b,c,d,e,f){this._getSatNetAddress=function(){var a=b.protocol(),c=b.host(),d=b.port();return"localhost"===c&&(d=f),""+a+"://"+c+":"+d},this._getRPCAddress=function(){return this._getSatNetAddress()+"/jrpc/"};var g=this._getRPCAddress();this._configuration=a.newService("configuration",g),this._simulation=a.newService("simulation",g),this._leop=a.newService("leop",g),this._network=a.newService("network",g),this._scheduling=a.newService("scheduling",g),this._services={"channels.options":this._configuration.createMethod("bands.available"),"gs.list":this._configuration.createMethod("gs.list"),"gs.add":this._configuration.createMethod("gs.create"),"gs.get":this._configuration.createMethod("gs.get"),"gs.update":this._configuration.createMethod("gs.set"),"gs.delete":this._configuration.createMethod("gs.delete"),"gs.channel.list":this._configuration.createMethod("gs.channel.list"),"gs.channel.add":this._configuration.createMethod("gs.channel.create"),"gs.channel.get":this._configuration.createMethod("gs.channel.get"),"gs.channel.set":this._configuration.createMethod("gs.channel.set"),"gs.channel.delete":this._configuration.createMethod("gs.channel.delete"),"rules.list":this._configuration.createMethod("gs.rules.list"),"rules.add":this._configuration.createMethod("gs.rules.add"),"rules.delete":this._configuration.createMethod("gs.rules.delete"),"sc.list":this._configuration.createMethod("sc.list"),"sc.add":this._configuration.createMethod("sc.create"),"sc.get":this._configuration.createMethod("sc.get"),"sc.update":this._configuration.createMethod("sc.set"),"sc.delete":this._configuration.createMethod("sc.delete"),"sc.channel.list":this._configuration.createMethod("sc.channel.list"),"sc.channel.add":this._configuration.createMethod("sc.channel.create"),"sc.channel.get":this._configuration.createMethod("sc.channel.get"),"sc.channel.set":this._configuration.createMethod("sc.channel.set"),"sc.channel.delete":this._configuration.createMethod("sc.channel.delete"),"user.getLocation":this._configuration.createMethod("user.getLocation"),"tle.celestrak.getSections":this._configuration.createMethod("tle.celestrak.sections"),"tle.celestrak.getResource":this._configuration.createMethod("tle.celestrak.resource"),"tle.celestrak.getTle":this._configuration.createMethod("tle.celestrak.tle"),"sc.getGroundtrack":this._simulation.createMethod("sc.groundtrack"),"sc.getPasses":this._simulation.createMethod("sc.passes"),"gs.getPasses":this._simulation.createMethod("gs.passes"),"net.alive":this._network.createMethod("alive"),"net.geoip":this._network.createMethod("geoip"),"gs.availability":this._scheduling.createMethod("gs.availability"),"sc.compatibility":this._scheduling.createMethod("sc.compatibility"),"gs.operational":this._scheduling.createMethod("gs.operational")},this._generateError=function(a,b,d,e){var f="Satnet.js@_generateError: invoking = <"+a+">, with params = <"+JSON.stringify(b)+">, code = <"+JSON.stringify(d)+">, description = <"+JSON.stringify(e)+">";throw c.warn(f),f},this.rCall=function(a,b){var d=this._generateError;if(this._services.hasOwnProperty(a)===!1)throw"@rCall: service not found, id = <"+a+">";return c.info("@rCall: Invoked service = <"+a+">, params = "+JSON.stringify(b)),this._services[a](b).then(function(e){"JSONRPCError"===e.data.name&&d(a,b,e.data.code,e.data.message);var f=", result = <";return f+="sc.getGroundtrack"===a?"$GT_TOO_LONG$>":JSON.stringify(e)+">",c.info("@rCall: Invoked service = <"+a+">, params = <"+JSON.stringify(b)+">, , result = <"+f),e.data},function(c){console.log("error = "+JSON.stringify(c)),d(a,b,"NONE",c)})},this.alive=function(){return this.rCall("net.alive",[]).then(function(){return!0})},this.getUserLocation=function(){var a=this._getSatNetAddress()+"/configuration/user/geoip";return e.get(a).then(function(a){return c.info("Satnet.js@getUserLocation: user@("+JSON.stringify(a.data)+")"),{latitude:parseFloat(a.data.latitude),longitude:parseFloat(a.data.longitude)}})},this.getServerLocation=function(a){return this.rCall("net.geoip",[a]).then(function(a){return a})},this.readSCCfg=function(a){var b={},c=[this.rCall("sc.get",[a]),this.rCall("sc.getGroundtrack",[a]),this.rCall("tle.celestrak.getTle",[a])];return d.all(c).then(function(a){return b=a[0],b.groundtrack=a[1],b.tle=a[2],angular.extend(b,a[0]),angular.extend(b.groundtrack,a[1]),angular.extend(b.tle,a[2]),b})},this.readAllLEOPGS=function(a){var b=this;return this.rCall("leop.gs.list",[a]).then(function(a){var c=[];return angular.forEach(a.leop_gs_available,function(a){c.push(b.rCall("gs.get",[a]))}),angular.forEach(a.leop_gs_inuse,function(a){c.push(b.rCall("gs.get",[a]))}),d.all(c).then(function(b){var c,d,e,f=[],g=[];for(c=0;c<b.length;c+=1)d=b[c],e=d.groundstation_id,a.leop_gs_available.indexOf(e)>=0?f.push(d):g.push(d);return{leop_gs_available:f,leop_gs_inuse:g}})})}}]),angular.module("snMapServices",["snJRPCServices","leaflet-directive"]).constant("T_OPACITY",.125).constant("LAT",37.7833).constant("LNG",-122.4167).constant("MIN_ZOOM",2).constant("MAX_ZOOM",12).constant("ZOOM",7).constant("ZOOM_SELECT",10).service("mapServices",["$q","leafletData","satnetRPC","MIN_ZOOM","MAX_ZOOM","ZOOM","T_OPACITY","ZOOM_SELECT",function(a,b,c,d,e,f,g){"use strict";this.getMainMap=function(){return b.getMap("mainMap").then(function(a){return{map:a}})},this._updateTerminator=function(a){var b=L.terminator();return a.setLatLngs(b.getLatLngs()),a.redraw(),a},this.createTerminatorMap=function(){var a=this._updateTerminator;return this.getMainMap().then(function(b){var c=L.terminator({fillOpacity:g});return c.addTo(b.map),b.terminator=c,setInterval(function(){a(c)},500),b})},this.autocenterMap=function(a,b){var d=this;return c.getUserLocation().then(function(c){d.configureMap(a,c.latitude,c.longitude,b)})},this.centerAtGs=function(a,b,d){var e=this;return c.rCall("gs.get",[b]).then(function(b){return e.configureMap(a,b.groundstation_latlon[0],b.groundstation_latlon[1],d),b})},this.configureMap=function(a,b,c,d){a.center={lat:b,lng:c,zoom:d},a.markers={gs:{lat:b,lng:c,focus:!1,draggable:!1,message:"Estimated Location",icon:{iconUrl:"/images/user.png",iconSize:[15,15]}}},"layers"in a&&("baselayers"in a.layers&&(a.layers.baselayers=this.getBaseLayers()),"overlays"in a.layers&&(a.layers.overlays=this.getOverlays()))},this.getBaseLayers=function(){return{cartodb_baselayer:{name:"CartoDB Base Layer",type:"xyz",url:"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",layerOptions:{noWrap:!1,continuousWorld:!1,subdomains:"abcd",minZoom:d,maxZoom:e,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}},esri_baselayer:{name:"ESRI Base Layer",type:"xyz",url:"https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",layerOptions:{noWrap:!1,continuousWorld:!1,minZoom:d,maxZoom:e,attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ"}},osm_baselayer:{name:"OSM Base Layer",type:"xyz",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{noWrap:!1,continuousWorld:!1,minZoom:d,maxZoom:e,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}}}},this.getESRIBaseLayer=function(){return{esri_baselayer:{name:"ESRI Base Layer",type:"xyz",url:"https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",layerOptions:{noWrap:!1,continuousWorld:!1,minZoom:d,maxZoom:e,attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ"}}}},this.getOSMBaseLayer=function(){return{osm_baselayer:{name:"OSM Base Layer",type:"xyz",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",layerOptions:{noWrap:!0,continuousWorld:!1,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}}}},this.getOverlays=function(){return{oms_admin_overlay:{name:"Administrative Boundaries",type:"xyz",url:"http://openmapsurfer.uni-hd.de/tiles/adminb/x={x}&y={y}&z={z}",visible:!0,layerOptions:{noWrap:!0,continuousWorld:!1,minZoom:d,maxZoom:e,attribution:'Imagery from <a href="http://giscience.uni-hd.de/">GIScience Research Group @ University of Heidelberg</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}},hydda_roads_labels_overlay:{name:"Roads and Labels",type:"xyz",url:"http://{s}.tile.openstreetmap.se/hydda/roads_and_labels/{z}/{x}/{y}.png",layerOptions:{noWrap:!0,continuousWorld:!1,minZoom:d,maxZoom:e,attribution:'Tiles courtesy of <a href="http://openstreetmap.se/" target="_blank">OpenStreetMap Sweden</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}},stamen_toner_labels_overlay:{name:"Labels",type:"xyz",url:"http://{s}.tile.stamen.com/toner-labels/{z}/{x}/{y}.png",layerOptions:{noWrap:!0,continuousWorld:!1,minZoom:d,maxZoom:e,subdomains:"abcd",attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}},owm_rain_overlay:{name:"Rain",type:"xyz",url:"http://{s}.tile.openweathermap.org/map/rain/{z}/{x}/{y}.png",layerOptions:{noWrap:!0,continuousWorld:!1,minZoom:d,maxZoom:e,opacity:.325,attribution:'Map data &copy; <a href="http://openweathermap.org">OpenWeatherMap</a>'}},owm_temperature_overlay:{name:"Temperature",type:"xyz",url:"http://{s}.tile.openweathermap.org/map/temp/{z}/{x}/{y}.png",layerOptions:{noWrap:!0,continuousWorld:!1,minZoom:d,maxZoom:e,attribution:'Map data &copy; <a href="http://openweathermap.org">OpenWeatherMap</a>'}},network:{name:"Network",type:"markercluster",visible:!0},groundstations:{name:"Ground Stations",type:"markercluster",visible:!0}}},this.asString=function(a){return'mapInfo = {"center": '+JSON.stringify(a.center)+', "terminator": '+a.terminator+', "map": '+a.map+"}"}}]),angular.module("snTimelineServices",[]).constant("SN_SCH_TIMELINE_DAYS",3).constant("SN_SCH_HOURS_DAY",3).constant("SN_SCH_DATE_FORMAT","DD-MM").constant("SN_SCH_HOUR_FORMAT","HH:mm").constant("SN_SCH_GS_ID_WIDTH",10).constant("SN_SCH_GS_ID_MAX_LENGTH",6).service("timeline",["$log","SN_SCH_TIMELINE_DAYS","SN_SCH_HOURS_DAY","SN_SCH_GS_ID_WIDTH","SN_SCH_DATE_FORMAT","SN_SCH_HOUR_FORMAT",function(a,b,c,d,e,f){this.discardSlot=function(b,c,d){return moment(c).isBefore(b.start_d)?(a.warn("Discarded, too OLD! slot = ("+c.toISOString()+", "+d.toISOString()+"), interval = ("+b.start_d.toISOString()+", "+b.end_d.toISOString()+")"),!0):moment(d).isAfter(b.end_d)?(a.warn("Discarded, too FUTURISTIC! slot = ("+c.toISOString()+", "+d.toISOString()+"), interval = ("+b.start_d.toISOString()+", "+b.end_d.toISOString()+")"),!0):!1},this.normalizeSlot=function(a,b,c){return console.log(">>1> start = "+b.toISOString()),console.log(">>1> end = "+c.toISOString()),b=moment(b).isBefore(a.start_d)?a.start_d:b,c=moment(c).isAfter(a.end_d)?a.end_d:c,console.log(">>2> start = "+b.toISOString()),console.log(">>2> end = "+c.toISOString()),{start:b,end:c}},this.filterSlots=function(a,b,c,d){var e=[];console.log("%%%% WINDOW: ("+moment(a.start_d).format()+", "+moment(a.end_d).format()+")");for(var f=0;f<c.length;f++){var g=c[f],h=moment(g.date_start),i=moment(g.date_end);if(!this.discardSlot(a,h,i)){console.log("%%%% raw_slot = "+JSON.stringify(g));var j=this.normalizeSlot(a,h,i);e.push(d(g,j)),console.log("%%%% n_slot = "+JSON.stringify(j))}}return e},this.initTimeScope=function(a){for(var b=moment().hours(0).minutes(0).seconds(0);b.isBefore(a.end_d);){var c=moment().hours(0).minutes(0).seconds(0),d=moment(b).format(e);a.days.push(d),a.times.push(d);for(var g=0;g<a.hours_per_day-1;g++)c=moment(c).add(a.hour_step,"hours"),a.times.push(c.format(f));b=moment(b).add(1,"days")}},this.initAnimationScope=function(a){var b=moment(),c=moment(b).unix(),d=c-a.start_d_s,e=d/a.total_s,f=e*a.scale_width*100,g=a.scaled_width;a.animation={initial_width:""+f.toFixed(3)+"%",final_width:""+g.toFixed(3)+"%",duration:""+a.total_s}},this.initScope=function(){var a={start_d:moment().hours(0).minutes(0).seconds(0),start_d_s:-1,end_d:null,end_d_s:-1,hour_step:null,gs_id_width:d+"%",max_width:100-d,scaled_width:100-d,scale_width:(100-d)/100,hours_per_day:c,no_days:b,total_s:-1,no_cols:-1,max_no_cols:-1,days:[],times:[],slots:{},animation:{initial_width:"",final_width:"",duration:""}};return a.end_d=moment(a.start_d).add(a.no_days,"days"),a.start_d_s=moment(a.start_d).unix(),a.end_d_s=moment(a.end_d).unix(),a.total_s=a.end_d_s-a.start_d_s,a.hour_step=moment.duration(24/a.hours_per_day,"hours"),a.no_cols=a.hours_per_day-1,a.max_no_cols=a.hours_per_day*a.no_days,this.initTimeScope(a),this.initAnimationScope(a),a}}]),angular.module("snSlotFilters",["snAvailabilityDirective"]).filter("slotify",["SN_SCH_TIMELINE_DAYS","snAvailabilityDlgCtrl",function(a,b){return function(c){if(!c)return[];if(0===c.length)return[];var d={},e=moment().hours(0).minutes(0).seconds(0),f=moment(e).add(a,"days");return angular.forEach(c,function(a,c){d[c]=b.filter_slots(c,a,e,f)}),d}}]),angular.module("snLoggerFilters",[]).constant("LOGGER_EVENT_KEYS",{debEvent:"DEBUG",logEvent:"LOG",infoEvent:"INFO",warnEvent:"WARNING",errEvent:"ERROR"}).filter("logEvent",["LOGGER_EVENT_KEYS",function(a){return function(b){return a.hasOwnProperty(b)?a[b]:b}}]),angular.module("snRuleFilters",[]).constant("RULE_PERIODICITIES",{rule_periodicity_once:"ONCE",rule_periodicity_daily:"DAILY",rule_periodicity_weekly:"WEEKLY"}).constant("SHORT_RULE_PERIODICITIES",{rule_periodicity_once:"O",rule_periodicity_daily:"D",rule_periodicity_weekly:"W"}).service("snDates",["$log",function(a){this.isoformat=function(a){return a.toISOString().split("Z")[0]+"+00:00"}}]).filter("printRule",["RULE_PERIODICITIES","SHORT_RULE_PERIODICITIES",function(a,b){return function(a){var c,d=b[a.rule_periodicity];return d===b.rule_periodicity_once&&(c=""+a.rule_dates.rule_once_starting_time.split("T")[0]+":"+a.rule_dates.rule_once_starting_time.split("T")[1]+">"+a.rule_dates.rule_once_ending_time.split("T")[1]),d===b.rule_periodicity_daily&&(c=""+a.rule_dates.rule_daily_initial_date.split("T")[0]+" > "+a.rule_dates.rule_daily_final_date.split("T")[0]),"("+a.rule_operation+","+d+")["+c+"]"}}]),angular.module("snMarkerModels",["snMapServices"]).constant("_RATE",1).constant("_SIM_DAYS",1).constant("_GEOLINE_STEPS",1).service("markers",["$log","mapServices","LAT","LNG","ZOOM","_SIM_DAYS","_GEOLINE_STEPS",function(a,b,c,d,e,f,g){this._mapInfo={},this._mapScope=null,this.getScope=function(){if(null===this._mapScope)throw"<_mapScope> has not been set.";return this._mapScope},this.configureMapScope=function(f){this._mapScope=f,angular.extend(this._mapScope,{center:{lat:c,lng:d,zoom:e},layers:{baselayers:{},overlays:{}},markers:{},paths:{},maxbounds:{}}),angular.extend(this._mapScope.layers.baselayers,b.getBaseLayers()),angular.extend(this._mapScope.layers.overlays,b.getOverlays());var g=this._mapInfo;b.createTerminatorMap(!0).then(function(c){return a.log("markers.js@configureMapScope: Created map = <"+b.asString(c)+">"),angular.extend(g,c),g})},this._KEY_HEADER="MK",this._key_number=0,this._ids2keys={},this.createMarkerKey=function(a){if(void 0!==this._ids2keys[a])return this.getMarkerKey(a);var b=this._KEY_HEADER+this._key_number;return this._key_number+=1,this._ids2keys[a]=b,b},this.getMarkerKey=function(a){if(this._ids2keys.hasOwnProperty(a)===!1)throw"@getMarkerKey: No key for <"+a+">";return this._ids2keys[a]},this.getServerMarker=function(a){if(null===this._serverMarkerKey)throw"@getServerMarker: no server for <"+a+">";return this.getScope().markers[this._serverMarkerKey]},this.getMarker=function(a){return this.getScope().markers[this.getMarkerKey(a)]},this.panTo=function(a){if(!a)throw"@panTo: no LatLng object provided";return b.getMainMap().then(function(b){return b.map.panTo(a,{animate:!0}),a})},this._serverMarkerKey=null,this.createServerMarker=function(a,b,c){return this._serverMarkerKey=this.createMarkerKey(a),this.getScope().markers[this._serverMarkerKey]={lat:b,lng:c,focus:!0,draggable:!1,layer:"network",icon:{iconUrl:"/images/server-icon-3.svg",iconSize:[15,15]},label:{message:a,options:{noHide:!0}},groundstations:[],identifier:a},a},this.createConnectorIdentifier=function(a){if(!a)throw"No identifier provided";var b=this.getServerMarker(a);return"connect:"+a+"_2_"+b.identifier},this.createGSConnector=function(a){if(!a)throw"@createGSConnector: no GS identifier provided";var b,c=this.getServerMarker(a),d=this.getMarker(a),e=this.createConnectorIdentifier(a),f={};return b=this.createMarkerKey(e),f[b]={color:"gray",type:"polyline",weight:3,opacity:.5,latlngs:[c,d],identifier:e},angular.extend(this.getScope().paths,f),e},this.panToGSMarker=function(a){if(!a)throw"@panToGSMarker: no GS identifier provided";var b=this.getMarker(a),c=new L.LatLng(b.lat,b.lng);return this.panTo(c)},this.createUnconnectedGSMarker=function(a){var b=a.groundstation_id,c=this.createMarkerKey(b);return this.getScope().markers[c]={lat:a.groundstation_latlon[0],lng:a.groundstation_latlon[1],focus:!0,draggable:!1,layer:"groundstations",icon:{iconUrl:"/images/gs-icon.svg",iconSize:[15,15]},label:{message:a.groundstation_id,options:{noHide:!0}},identifier:b},b},this.createGSMarker=function(a){var b=a.groundstation_id;return this.createUnconnectedGSMarker(a),this.createGSConnector(b),b},this.updateGSMarker=function(a){if(null===a)throw"@updateGSMarker, wrong <cfg>";var b=a.groundstation_latlon[0],c=a.groundstation_latlon[1],d=this.getMarker(a.groundstation_id);return d.lat!==b&&(d.lat=b),d.lng!==c&&(d.lng=c),a.groundstation_id},this.removeGSConnector=function(a){var b=this.getMarkerKey(this.createConnectorIdentifier(a));this.getScope().paths.hasOwnProperty(b)&&delete this.getScope().paths[b]},this.removeGSMarker=function(a){var b=this.getMarkerKey(a);delete this.getScope().markers[b],this.removeGSConnector(a)},this.sc={},this.scLayers=L.layerGroup(),this.trackLayers=L.layerGroup(),this.scStyle={autostart:!0,draggable:!1,icon:L.icon({iconUrl:"/images/sc-icon-2.svg",iconSize:[15,15]})},this.trackStyle={weight:1,opacity:.725,steps:g},this.colors=["#003366"],this.color_n=0,this.panToSCMarker=function(a){if(!a)throw"@panToSCMarker: no SC identifier provided";if(!(a in this.sc))throw"@panToSCMarker: no SC marker for <"+a+">";var b=this.sc[a],c=b.marker.getLatLng();return this.panTo(c)},this._addPositions=function(a,b,c){a.positions.push([b,c]),a.geopoints.push(new L.LatLng(b,c))},this._addDurations=function(a,b,c){a.durations.push((b.timestamp-c.timestamp)/1e3),a.valid=!0},this._processTrackPoints=function(a,b,c){for(var d={positions:[],geopoints:[],durations:[],valid:!1},e=!0,f=0;f<a.length;f+=1){var g=a[f];if(!(g.timestamp<b)){if(g.timestamp>c)break;this._addPositions(d,g.latitude,g.longitude),e!==!0?this._addDurations(d,g,a[f-1]):e=!1}}return d},this.readTrack=function(a){var b=1e3*Date.now(),c=1e3*moment().add(f,"days").toDate().getTime();if(null===a||0===a.length)throw"@readTrack: empty groundtrack";var d=this._processTrackPoints(a,b,c);if(d.valid===!1)throw"@readTrack: invalid groundtrack";return d},this.createSCMarkers=function(a){if(!a||!Object.keys(a).length)throw"@createSCMarkers: wrong cfg, no <spacecraft_id>";var b,c=a.spacecraft_id,d=this.scStyle,e=this.colors[this.color_n%this.colors.length];
return this.color_n+=1,this.trackStyle.color=e,b=this.readTrack(a.groundtrack),{marker:L.Marker.movingMarker(b.positions,b.durations,d).bindLabel(c,{noHide:!0}),track:L.geodesic([b.geopoints],this.trackStyle)}},this.addSC=function(a,c){if(!a)throw"@addSC: wrong id";if(this.sc.hasOwnProperty(a))throw"@addSC: SC Marker already exists, id = "+a;var d=this.createSCMarkers(c);return this.sc[a]=d,this.scLayers.addLayer(d.marker),this.trackLayers.addLayer(d.track),b.getMainMap().then(function(b){return d.track.addTo(b.map),d.marker.addTo(b.map),a})},this.updateSC=function(b,c){if(!b)throw"@updateSC: no id provided";if(!this.sc.hasOwnProperty(b))throw"@updateSC: marker <"+b+"> does not exist";var d=this;return this.removeSC(b).then(function(e){a.log("@updateSC: marker <"+e+"> removed"),d.addSC(b,c).then(function(b){a.log("@updateSC: marker <"+b+"> added")})}),b},this.removeSC=function(a){if(!a)throw"@removeSC: no id provided";if(!this.sc.hasOwnProperty(a))throw"@removeSC: marker <"+a+"> does not exist";var c=this.sc[a];return this.scLayers.removeLayer(c.marker),this.trackLayers.removeLayer(c.track),delete this.sc[a],b.getMainMap().then(function(b){return b.map.removeLayer(c.marker),b.map.removeLayer(c.track),a})}}]),angular.module("snNetworkModels",["snJRPCServices","snMarkerModels"]).service("serverModels",["$rootScope","$log","$location","broadcaster","satnetRPC","markers",function(a,b,c,d,e,f){this._initListeners=function(){a.$on(d.KEEP_ALIVE_EVENT,function(a,c){b.log("ev = "+a+", msg = "+c),e.alive().then(function(a){b.log("alive! data = "+JSON.stringify(a))})})},this.initStandalone=function(){this._initListeners();var a=c.host();return e.getServerLocation(a).then(function(b){return f.createServerMarker(a,b.latitude,b.longitude)})}}]),angular.module("snGroundStationModels",["snBroadcasterServices","snPushServices","snJRPCServices","snMarkerModels"]).service("gsModels",["$rootScope","$q","$log","broadcaster","satnetRPC","markers",function(a,b,c,d,e,f){this.initAll=function(){var a=this;return e.rCall("gs.list",[]).then(function(b){return a._initAll(b)})},this.initAllLEOP=function(a){var c=this,d=[];return e.rCall("leop.gs.list",[a]).then(function(a){return angular.forEach(a.leop_gs_inuse,function(a){d.push(c.addGS(a))}),angular.forEach(a.leop_gs_available,function(a){d.push(c.addUnconnectedGS(a))}),b.all(d).then(function(a){var b=[];return angular.forEach(a,function(a){b.push(a)}),b})})},this._initAll=function(a){var c=this,d=[];return angular.forEach(a,function(a){d.push(c.addGS(a))}),b.all(d).then(function(a){var b=[];return angular.forEach(a,function(a){b.push(a)}),b})},this.addGS=function(a){return e.rCall("gs.get",[a]).then(function(a){return f.createGSMarker(a)})},this.addUnconnectedGS=function(a){return e.rCall("gs.get",[a]).then(function(a){return f.createUnconnectedGSMarker(a)})},this.connectGS=function(a){f.createGSConnector(a)},this.disconnectGS=function(a){f.removeGSConnector(a)},this.updateGS=function(a){e.rCall("gs.get",[a]).then(function(a){return f.updateGSMarker(a)})},this.removeGS=function(a){return f.removeGSMarker(a)},this.initListeners=function(){var b=this;a.$on(d.GS_ADDED_EVENT,function(a,d){c.log("@on-gs-added-event, event = "+a+", id = "+d),b.addGS(d)}),a.$on(d.GS_REMOVED_EVENT,function(a,d){c.log("@on-gs-removed-event, event = "+a+", id = "+d),b.removeGS(d)}),a.$on(d.GS_UPDATED_EVENT,function(a,d){c.log("@on-gs-updated-event, event = "+a+", id = "+d),b.updateGS(d)}),a.$on(d.LEOP_GS_ASSIGNED_EVENT,function(a,d){c.log("@on-gs-assigned-event, event = "+a+", id = "+d),b.connectGS(d)}),a.$on(d.LEOP_GS_RELEASED_EVENT,function(a,d){c.log("@on-gs-released-event, event = "+a+", id = "+d),b.disconnectGS(d)}),a.$on(d.GS_AVAILABLE_ADDED_EVENT,function(a,d){c.log("@on-gs-added-event, event = "+a+", id = "+d),b.addUnconnectedGS(d)}),a.$on(d.GS_AVAILABLE_REMOVED_EVENT,function(a,d){c.log("@on-gs-removed-event, event = "+a+", id = "+d),b.removeGS(d)}),a.$on(d.GS_AVAILABLE_UPDATED_EVENT,function(a,d){c.log("@on-gs-updated-event, event = "+a+", id = "+d),b.updateGS(d)})}}]),angular.module("snSpacecraftModels",["snBroadcasterServices","snJRPCServices","snMarkerModels"]).service("scModels",["$rootScope","$log","$q","broadcaster","satnetRPC","markers",function(a,b,c,d,e,f){this.initAll=function(){var a=this;return e.rCall("sc.list",[]).then(function(b){var d=[];return angular.forEach(b,function(b){d.push(a.addSC(b))}),c.all(d).then(function(a){return a})})},this.initAllLEOP=function(){var b=this;return e.rCall("leop.sc.list",[a.leop_id]).then(function(a){var d=[];return angular.forEach(a,function(a){d.push(b.addSC(a))}),c.all(d).then(function(a){return a})})},this.addSC=function(a){return e.readSCCfg(a).then(function(b){return f.addSC(a,b)})},this.updateSC=function(a){return e.readSCCfg(a).then(function(b){return f.updateSC(a,b)})},this.removeSC=function(a){return f.removeSC(a).then(function(a){return a})},this.initListeners=function(){var c=this;a.$on(d.SC_ADDED_EVENT,function(a,d){b.log("@on-sc-added-event, event = "+a+", id = "+d),c.addSC(d)}),a.$on(d.SC_UPDATED_EVENT,function(a,d){b.log("@on-sc-updated-event, event = "+a+", id = "+d),c.updateSC(d)}),a.$on(d.SC_REMOVED_EVENT,function(a,d){b.log("@on-sc-removed-event, event = "+a+", id = "+d),c.removeSC(d)})}}]),angular.module("snAboutDirective",["ngMaterial"]).controller("snAboutDlgCtrl",["$scope","$mdDialog",function(a,b){a.closeDialog=function(){b.hide()}}]).controller("snAboutCtrl",["$scope","$mdDialog",function(a,b){a.openSnAbout=function(){b.show({templateUrl:"common/templates/about/dialog.html"})}}]).directive("snAbout",function(){return{restrict:"E",templateUrl:"common/templates/about/menu.html"}}),angular.module("snAvailabilityDirective",["ngMaterial","snControllers","snJRPCServices","snTimelineServices"]).controller("snAvailabilitySchCtrl",["$scope","$log","satnetRPC","snDialog","SN_SCH_GS_ID_MAX_LENGTH","timeline",function(a,b,c,d,e,f){a.gui=null,a.createSlot=function(b,c){var d=moment(c.start).unix(),f=moment(c.end).unix(),g=d-a.gui.start_d_s,h=g/a.gui.total_s*100,i=f-d,j=i/a.gui.total_s*100,k=b.identifier+"";return{raw_slot:b,slot:{id:k.substring(e),s_date:moment(c.start).format(),e_date:moment(c.end).format(),left:h.toFixed(3),width:j.toFixed(3)}}},a.getGSSlots=function(a){return c.rCall("gs.availability",[a]).then(function(b){return{groundstation_id:a,slots:b}})["catch"](function(b){d.exception("gs.availability",a,b)})},a.init=function(){a.gui=f.initScope(),c.rCall("gs.list",[]).then(function(b){angular.forEach(b,function(b){a.getGSSlots(b).then(function(c){a.gui.slots[b]=f.filterSlots(a.gui,b,c.slots,a.createSlot)})})})["catch"](function(a){d.exception("gs.list",[],a)})}}]).directive("snAvailabilityScheduler",function(){return{restrict:"E",templateUrl:"common/templates/availability/scheduler.html"}}).controller("snAvailabilityDlgCtrl",["$scope","$mdDialog",function(a,b){a.close=function(){b.hide()}}]).controller("snAvailabilityCtrl",["$scope","$mdDialog",function(a,b){a.openDialog=function(){b.show({templateUrl:"common/templates/availability/dialog.html",controller:"snAvailabilityDlgCtrl"})}}]).directive("snAvailability",function(){return{restrict:"E",templateUrl:"common/templates/availability/menu.html"}}),angular.module("snCompatibilityDirective",["ngMaterial","snControllers","snJRPCServices"]).controller("snCompatibilityCtrl",["$scope","$mdDialog",function(a,b){a.openDialog=function(){b.show({templateUrl:"common/templates/compatibility/dialog.html",controller:"snCompatibilityDlgCtrl"})}}]).controller("snCompatibilityDlgCtrl",["$scope","$mdDialog","satnetRPC","snDialog",function(a,b,c,d){a.compatibility=[],a.close=function(){b.hide()},a.loadCompatibility=function(){c.rCall("sc.list",[]).then(function(b){angular.forEach(b,function(b){c.rCall("sc.compatibility",[b]).then(function(b){var c=angular.copy(b);a.compatibility.push(c)},function(a){d.exception("sc.compatibility","-",a)})})},function(a){d.exception("sc.list","-",a)})},a.init=function(){a.loadCompatibility()}}]).directive("snCompatibility",[function(){return{restrict:"E",templateUrl:"common/templates/compatibility/menu.html"}}]),angular.module("snLoggerDirective",[]).constant("MAX_LOG_MSGS",20).constant("TIMESTAMP_FORMAT","HH:mm:ss.sss").controller("snLoggerCtrl",["$scope","$filter","TIMESTAMP_FORMAT","MAX_LOG_MSGS",function(a,b,c,d){a.eventLog=[],a.logEvent=function(e,f){a.eventLog.unshift({type:e.name,timestamp:b("date")(new Date,c),msg:f}),a.eventLog.length>d&&a.eventLog.pop()},a.$on("logEvent",function(b,c){a.logEvent(b,c)}),a.$on("infoEvent",function(b,c){a.logEvent(b,c)}),a.$on("warnEvent",function(b,c){a.logEvent(b,c)}),a.$on("errEvent",function(b,c){a.logEvent(b,c)}),a.$on("debEvent",function(b,c){a.logEvent(b,c)})}]).directive("snLogger",[function(){return{restrict:"E",templateUrl:"common/templates/sn-logger.html"}}]).config(["$provide",function(a){a.decorator("$log",function(a){var b=null;return{setScope:function(a){b=a},log:function(c){a.log.apply(null,[c]),b.$broadcast("logEvent",c)},info:function(c){a.info.apply(null,[c]),b.$broadcast("infoEvent",c)},error:function(){a.error.apply(null,arguments),b.$broadcast("errEvent",arguments)},debug:function(){a.debug.apply(null,arguments),b.$broadcast("debEvent",arguments[0])},warn:function(c){a.warn.apply(null,[c]),b.$broadcast("warnEvent",c)}}})}]).run(["$rootScope","$log",function(a,b){b.setScope(a)}]),angular.module("snSplashDirective",[]).directive("mAppLoading",["$animate",function(a){var b=function(b,c,d){a.leave(c.children().eq(1)).then(function(){c.remove(),b=c=d=null})};return{link:b,restrict:"C"}}]),angular.module("snTimelineDirective",["snTimelineServices"]).controller("snTimelineCtrl",["$scope","$log","timeline",function(a,b,c){a.gui=null,a.init=function(){a.gui=c.initScope()}}]).directive("snTimeline",function(){return{restrict:"E",templateUrl:"common/templates/availability/timeline.html",controller:"snTimelineCtrl"}}),angular.module("snChannelControllers",["ngMaterial","snJRPCServices","snControllers"]).constant("CH_LIST_TPL","operations/templates/channels/list.html").constant("CH_DLG_GS_TPL","operations/templates/channels/gs.dialog.html").constant("CH_DLG_SC_TPL","operations/templates/channels/sc.dialog.html").controller("channelListCtrl",["$scope","$log","$mdDialog","satnetRPC","snDialog","RPC_GS_PREFIX","RPC_SC_PREFIX","CH_DLG_GS_TPL","CH_DLG_SC_TPL","segmentId","isSpacecraft",function(a,b,c,d,e,f,g,h,i,j,k){a.channelList=[],a.uiCtrl={segmentId:j,isSpacecraft:k,rpcPrefix:f,channelDlgTplUrl:h},a.showAddDialog=function(){c.hide(),c.show({templateUrl:a.uiCtrl.channelDlgTplUrl,controller:"channelDialogCtrl",locals:{segmentId:a.uiCtrl.segmentId,channelId:"",isSpacecraft:a.uiCtrl.isSpacecraft,isEditing:!1}})},a.showEditDialog=function(b){c.hide(),c.show({templateUrl:a.uiCtrl.channelDlgTplUrl,controller:"channelDialogCtrl",locals:{segmentId:a.uiCtrl.segmentId,channelId:b,isSpacecraft:a.uiCtrl.isSpacecraft,isEditing:!0}})},a["delete"]=function(b){var c=a.uiCtrl.rpcPrefix+".channel.delete";d.rCall(c,[a.uiCtrl.segmentId,b]).then(function(d){e.success(c,b,d,null),a.refresh()})["catch"](function(a){e.exception(c,b,a)})},a.refresh=function(){var b=a.uiCtrl.rpcPrefix+".channel.list";d.rCall(b,[a.uiCtrl.segmentId]).then(function(b){null!==b&&(a.channelList=b.slice(0))})["catch"](function(a){e.exception(b,"-",a)})},a.init=function(){a.uiCtrl.isSpacecraft===!0&&(a.uiCtrl.rpcPrefix=g,a.uiCtrl.channelDlgTplUrl=i),a.refresh()},a.init()}]).controller("channelDialogCtrl",["$log","$scope","$mdDialog","$mdToast","broadcaster","satnetRPC","snDialog","RPC_GS_PREFIX","RPC_SC_PREFIX","CH_LIST_TPL","segmentId","channelId","isSpacecraft","isEditing",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.gsCfg={channel_id:l,band:"",automated:!1,modulations:[],polarizations:[],bitrates:[],bandwidths:[]},b.scCfg={channel_id:l,frequency:0,modulation:"",polarization:"",bitrate:"",bandwidth:""},b.uiCtrl={add:{disabled:!0},segmentId:k,isSpacecraft:m,isEditing:n,rpcPrefix:h,listTplOptions:{tempalteUrl:j,controller:"channelListCtrl",locals:{segmentId:k,isSpacecraft:m}},configuration:b.gsCfg,options:{bands:[],modulations:[],polarizations:[],bandwidths:[]}},b.add=function(){var a=b.uiCtrl.rpcPrefix+".channel.add";b.uiCtrl.isSpacecraft===!0&&(b.uiCtrl.configuration.frequency*=1e6),f.rCall(a,[b.uiCtrl.segmentId,b.uiCtrl.configuration.channel_id,b.uiCtrl.configuration]).then(function(d){c.hide(),g.success(a,b.uiCtrl.segmentId,d,null)})["catch"](function(b){g.exception(a,"-",b)})},b.update=function(){var a=b.uiCtrl.rpcPrefix+".channel.set";b.uiCtrl.isSpacecraft===!0&&(b.uiCtrl.configuration.frequency*=1e6),f.rCall(a,[b.uiCtrl.segmentId,b.uiCtrl.configuration.channel_id,b.uiCtrl.configuration]).then(function(d){c.hide(),g.success(a,b.uiCtrl.segmentId,d,null)})["catch"](function(b){g.exception(a,"-",b)})},b.cancel=function(){c.hide()},b.init=function(){if(!k)throw"@channelDialogCtrl: no segment identifier provided";if(b.uiCtrl.isSpacecraft===!0&&(b.uiCtrl.rpcPrefix=i,b.uiCtrl.configuration=b.scCfg),null===n)throw"@channelDialogCtrl: no editing flag provided";if(b.uiCtrl.isEditing===!0){if(!l)throw"@channelDialogCtrl: no channel identifier provided";b.loadConfiguration()}b.loadOptions()},b.loadConfiguration=function(){var a=b.uiCtrl.rpcPrefix+".channel.get";f.rCall(a,[b.uiCtrl.segmentId,b.uiCtrl.configuration.channel_id]).then(function(a){b.uiCtrl.isSpacecraft===!0?(a.frequency=parseFloat(a.frequency),a.frequency/=1e6,b.scCfg=angular.copy(a),b.uiCtrl.configuration=b.scCfg):(b.gsCfg=angular.copy(a),b.uiCtrl.configuration=b.gsCfg)})["catch"](function(b){g.exception(a,"-",b)})},b.loadOptions=function(){var a="channels.options";f.rCall(a,[]).then(function(a){b.uiCtrl.options=angular.copy(a)})["catch"](function(b){g.exception(a,"-",b)})}}]),angular.module("snGsControllers",["ngMaterial","remoteValidation","leaflet-directive","snBroadcasterServices","snJRPCServices","snControllers","snChannelControllers","snRuleControllers","snMapServices"]).controller("gsListCtrl",["$log","$scope","$mdDialog","$mdToast","broadcaster","satnetRPC","snDialog",function(a,b,c,d,e,f,g){b.gsList=[],b.showAddDialog=function(){c.show({templateUrl:"operations/templates/segments/gs.dialog.html",controller:"gsDialogCtrl",locals:{identifier:"",isEditing:!1}})},b.showEditDialog=function(a){c.show({templateUrl:"operations/templates/segments/gs.dialog.html",controller:"gsDialogCtrl",locals:{identifier:a,isEditing:!0}})},b.showChannelList=function(a){c.show({templateUrl:"operations/templates/channels/list.html",controller:"channelListCtrl",locals:{segmentId:a,isSpacecraft:!1}})},b.showRuleList=function(a){c.show({templateUrl:"operations/templates/rules/list.html",controller:"ruleListCtrl",locals:{identifier:a}})},b["delete"]=function(a){f.rCall("gs.delete",[a]).then(function(c){e.gsRemoved(a),g.success("gs.delete",a,c,null),b.refresh()})["catch"](function(b){g.exception("gs.delete",a,b)})},b.refresh=function(){f.rCall("gs.list",[]).then(function(a){null!==a&&(b.gsList=a.slice(0))})["catch"](function(a){g.exception("gs.list","-",a)})},b.init=function(){b.refresh()},b.init()}]).controller("gsDialogCtrl",["$log","$scope","$mdDialog","$mdToast","broadcaster","satnetRPC","snDialog","mapServices","LAT","LNG","ZOOM_SELECT","identifier","isEditing",function(a,b,c,d,e,f,g,h,i,j,k,l,m){l||(l=""),m||(m=!1),b.configuration={identifier:l,callsign:"",elevation:0},b.uiCtrl={add:{disabled:!0},isEditing:m},b.center={},b.markers={gs:{lat:0,lng:0,message:"Drag me to your GS!",draggable:!0,focus:!1}},b.events={},b.eventDetected="No events yet...",b.$on("leafletDirectiveMarker.dragend",function(a,c){b.markers.gs.lat=c.leafletObject._latlng.lat,b.markers.gs.lng=c.leafletObject._latlng.lng}),b.listTplUrl="operations/templates/segments/gs.list.html",b.add=function(){var a=[b.configuration.identifier,b.configuration.callsign,b.configuration.elevation.toFixed(2),b.markers.gs.lat.toFixed(6),b.markers.gs.lng.toFixed(6)];f.rCall("gs.add",a).then(function(a){var b=a.groundstation_id;e.gsAdded(b),c.hide(),g.success(b,a,null)},function(a){g.exception("gs.add","-",a)})},b.update=function(){var a={groundstation_id:l,groundstation_callsign:b.configuration.callsign,groundstation_elevation:b.configuration.elevation.toFixed(2),groundstation_latlon:[b.markers.gs.lat.toFixed(6),b.markers.gs.lng.toFixed(6)]};f.rCall("gs.update",[l,a]).then(function(a){e.gsUpdated(a),c.hide(),g.success(a,a,null)},function(a){g.exception("gs.update","-",a)})},b.cancel=function(){c.hide(),c.show({templateUrl:b.listTplUrl})},b.init=function(){m?b.loadConfiguration():b.initConfiguration()},b.initConfiguration=function(){f.getUserLocation().then(function(a){angular.extend(b.center,{lat:a.latitude,lng:a.longitude,zoom:k}),b.markers.gs.lat=a.latitude,b.markers.gs.lng=a.longitude,b.markers.gs.focus=!0})},b.loadConfiguration=function(){h.centerAtGs(b,l,8).then(function(a){b.configuration.identifier=a.groundstation_id,b.configuration.callsign=a.groundstation_callsign,b.configuration.elevation=a.groundstation_elevation,b.markers.gs.focus=!0,b.markers.gs.message="Drag me to your GS!",b.markers.gs.draggable=!0})}}]),angular.module("snOperationsMenuControllers",["ngMaterial","snScControllers","snGsControllers"]).controller("operationsMenuCtrl",["$scope","$mdSidenav","$mdDialog",function(a,b,c){a.close=function(){b("menu").close()},a.showGsMenu=function(){c.show({templateUrl:"operations/templates/segments/gs.list.html",controller:"gsListCtrl"})},a.showScMenu=function(){c.show({templateUrl:"operations/templates/segments/sc.list.html",controller:"scListCtrl"})}}]),angular.module("snRuleControllers",["ngMaterial","snJRPCServices","snControllers","snRuleFilters"]).controller("ruleListCtrl",["$scope","$log","$mdDialog","satnetRPC","snDialog","identifier",function(a,b,c,d,e,f){a.identifier=f,a.ruleList=[],a.dlgTplUrl="operations/templates/rules/dialog.html",a.showAddDialog=function(){c.show({templateUrl:a.dlgTplUrl,controller:"ruleDialogCtrl",locals:{identifier:a.identifier,isEditing:!1}})},a.showEditDialog=function(b){c.show({templateUrl:a.dlgTplUrl,controller:"ruleDialogCtrl",locals:{identifier:a.identifier,isEditing:!0,ruleKey:b.key}})},a["delete"]=function(b){d.rCall("rules.delete",[a.identifier,b.key]).then(function(b){e.success("rules.delete",f,b,null),a.refresh()})["catch"](function(a){e.exception("rules.delete",f,a)})},a.refresh=function(){d.rCall("rules.list",[a.identifier]).then(function(b){null!==b&&(a.ruleList=b.slice(0))})["catch"](function(a){e.exception("rules.list","-",a)})},a.init=function(){a.refresh()},a.init()}]).constant("CREATE_OPERATION","+").constant("ERASE_OPERATION","-").constant("ONCE_PERIODICITY","O").constant("DAILY_PERIODICITY","D").constant("WEEKLY_PERIODICITY","W").constant("DATES_SERIAL","rule_dates").constant("ONCE_PERIODICITY_SERIAL","rule_periodicity_once").constant("DAILY_PERIODICITY_SERIAL","rule_periodicity_daily").constant("WEEKLY_PERIODICITY_SERIAL","rule_periodicity_weekly").constant("NG_DATE_FORMAT","YYYY-MM-DD").controller("ruleDialogCtrl",["$scope","$mdDialog","satnetRPC","snDialog","CREATE_OPERATION","ERASE_OPERATION","ONCE_PERIODICITY","DAILY_PERIODICITY","WEEKLY_PERIODICITY","DATES_SERIAL","ONCE_PERIODICITY_SERIAL","DAILY_PERIODICITY_SERIAL","WEEKLY_PERIODICITY_SERIAL","NG_DATE_FORMAT","identifier","isEditing",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.rule={operation:e,periodicity:g,start_date:"",end_date:"",onceCfg:{start_time:"",end_time:""},dailyCfg:{start_time:"",end_time:""},weeklyCfg:{}},a.uiCtrl={activeTab:0,endDateDisabled:!0,invalidDate:!1,invalidOnceTime:!1,invalidDailyTime:!1,invalidWeeklyTime:!1,identifier:o,isEditing:p,minDate:null,maxDate:null},a.setOnceFlags=function(){a.uiCtrl.endDateDisabled=!0,a.uiCtrl.invalidDailyTime=!1,a.uiCtrl.invalidWeeklyTime=!1},a.setDailyFlags=function(){a.uiCtrl.endDateDisabled=!1,a.uiCtrl.invalidOnceTime=!1,a.uiCtrl.invalidWeeklyTime=!1},a.setWeeklyFlags=function(){a.uiCtrl.endDateDisabled=!1},a.switch2Once=function(){a.uiCtrl.activeTab=0,a.rule.periodicity=g,a.setOnceFlags(),a.validateOnceTimes()},a.switch2Daily=function(){a.uiCtrl.activeTab=1,a.rule.periodicity=h,a.setDailyFlags(),a.validateDailyTimes()},a.switch2Weekly=function(){a.uiCtrl.activeTab=2,a.rule.periodicity=i,a.setWeeklyFlags()},a.periodicityChanged=function(){return a.rule.periodicity===g?void a.switch2Once():a.rule.periodicity===h?void a.switch2Daily():a.rule.periodicity===i?void a.switch2Weekly():void 0},a.tabSelected=function(b){return b===g?void a.switch2Once():b===h?void a.switch2Daily():b===i?void a.switch2Weekly():void 0},a.validateOnceTimes=function(){a.rule.onceCfg.start_time.getTime()>a.rule.onceCfg.end_time.getTime()?(a.uiCtrl.invalidOnceTime=!0,a.configuration.$setValidity("",!1)):(a.uiCtrl.invalidOnceTime=!1,a.configuration.$setValidity("",!0)),a.configuration.once_start_time.$valid=!a.uiCtrl.invalidOnceTime,a.configuration.once_end_time.$valid=!a.uiCtrl.invalidOnceTime,a.configuration.once_start_time.$invalid=a.uiCtrl.invalidOnceTime,a.configuration.once_end_time.$invalid=a.uiCtrl.invalidOnceTime},a.validateDailyTimes=function(){a.rule.dailyCfg.start_time.getTime()>a.rule.dailyCfg.end_time.getTime()?(a.uiCtrl.invalidDailyTime=!0,a.configuration.$setValidity("",!1)):(a.uiCtrl.invalidDailyTime=!1,a.configuration.$setValidity("",!0)),a.configuration.once_start_time.$valid=!a.uiCtrl.invalidDailyTime,a.configuration.once_end_time.$valid=!a.uiCtrl.invalidDailyTime,a.configuration.once_start_time.$invalid=a.uiCtrl.invalidDailyTime,a.configuration.once_end_time.$invalid=a.uiCtrl.invalidDailyTime},a.validateDates=function(){a.rule.start_date.getTime()>=a.rule.end_date.getTime()?(a.uiCtrl.invalidDate=!0,a.configuration.$setValidity("",!1)):(a.uiCtrl.invalidDate=!1,a.configuration.$setValidity("",!0))},a.startDateChanged=function(){a.rule.periodicity!==g&&a.rule.start_date&&a.rule.end_date&&(a.validateDates(),a.minDate=a.rule.start_date.toISOString().split("T")[0])},a.endDateChanged=function(){a.rule.start_date&&a.rule.end_date&&a.validateDates()},a.cancel=function(){b.hide()},a.combineDates=function(a,b){var c=new Date(a);return c.setHours(b.getHours()),c.setMinutes(b.getMinutes()),c},a.createOnceDates=function(b){var c=a.combineDates(a.rule.start_date,a.rule.onceCfg.start_time),d=a.combineDates(a.rule.start_date,a.rule.onceCfg.end_time);b[j]={rule_once_starting_time:c.toISOString(),rule_once_ending_time:d.toISOString()}},a.createDailyDates=function(b){var c=a.combineDates(a.rule.start_date,a.rule.dailyCfg.start_time),d=a.combineDates(a.rule.start_date,a.rule.dailyCfg.end_time);b[j]={rule_daily_initial_date:a.rule.start_date.toISOString(),rule_daily_final_date:a.rule.end_date.toISOString(),rule_starting_time:c.toISOString(),rule_ending_time:d.toISOString()}},a.add=function(){var e={};e.rule_operation=a.rule.operation,a.rule.periodicity===g?(e.rule_periodicity=k,a.createOnceDates(e)):(e.rule_periodicity=l,a.createDailyDates(e)),c.rCall("rules.add",[o,e]).then(function(a){var c=a.spacecraft_id;b.hide(),d.success("rules.add",c,a,null)},function(a){d.exception("rules.add","-",a)})},a.init=function(){var b=new Date(moment().utc().format(n)),c=new Date(moment().utc().add(1,"days").format(n)),d=new Date(moment().utc().add(1,"hours").format(n)),e=new Date(moment().utc().format(n)).toISOString().split("T")[0],f=new Date(moment().utc().add(1,"years").format(n)).toISOString().split("T")[0];a.rule.start_date=b,a.rule.end_date=c,a.rule.onceCfg.start_time=b,a.rule.onceCfg.end_time=d,a.rule.dailyCfg.start_time=b,a.rule.dailyCfg.end_time=d,a.uiCtrl.minDate=e,a.uiCtrl.maxDate=f},a.init()}]),angular.module("snScControllers",["ngMaterial","remoteValidation","leaflet-directive","snBroadcasterServices","snMapServices","snControllers","snCelestrakServices"]).controller("scListCtrl",["$log","$scope","$mdDialog","$mdToast","broadcaster","satnetRPC","snDialog",function(a,b,c,d,e,f,g){b.scList=[],b.showAddDialog=function(){c.show({templateUrl:"operations/templates/segments/sc.dialog.html",controller:"scDialogCtrl",locals:{identifier:"",editing:!1}})},b.showEditDialog=function(a){c.show({templateUrl:"operations/templates/segments/sc.dialog.html",controller:"scDialogCtrl",locals:{identifier:a,editing:!0}})},b.showChannelList=function(a){c.show({templateUrl:"operations/templates/channels/list.html",controller:"channelListCtrl",locals:{segmentId:a,isSpacecraft:!0}})},b["delete"]=function(a){f.rCall("sc.delete",[a]).then(function(c){e.scRemoved(a),g.success("sc.delete",a,c,null),b.refresh()})["catch"](function(b){g.exception("sc.delete",a,b)})},b.refresh=function(){f.rCall("sc.list",[]).then(function(a){null!==a&&(b.scList=a.slice(0))})["catch"](function(a){g.exception("sc.list","-",a)})},b.init=function(){b.refresh()},b.init()}]).controller("scDialogCtrl",["$log","$scope","$mdDialog","$mdToast","broadcaster","satnetRPC","celestrak","snDialog","mapServices","LAT","LNG","ZOOM_SELECT","identifier","editing",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){m||(m=""),n||(n=!1),b.configuration={identifier:m,callsign:"",tle_group:"",tle:""},b.uiCtrl={add:{disabled:!0},editing:n,tle_groups:g.CELESTRAK_SELECT_SECTIONS,tles:[]},b.listTemplateUrl="operations/templates/segments/sc.list.html",b.updateTles=function(){b.configuration.tle_group&&f.rCall("tle.celestrak.getResource",[b.configuration.tle_group.subsection]).then(function(a){b.uiCtrl.tles=a.tle_list.slice(0)})},b.add=function(){var a=[b.configuration.identifier,b.configuration.callsign,b.configuration.tle.spacecraft_tle_id];f.rCall("sc.add",a).then(function(a){var b=a.spacecraft_id;e.scAdded(b),c.hide(),h.success("sc.add",b,a,null)},function(a){h.exception("sc.add","-",a)})},b.update=function(){var a={spacecraft_id:m,spacecraft_callsign:b.configuration.callsign,spacecraft_tle_id:b.configuration.tle.spacecraft_tle_id};f.rCall("sc.update",[m,a]).then(function(a){e.scUpdated(a),c.hide(),h.success("sc.update",a,a,null)},function(a){h.exception("sc.update","-",a)})},b.cancel=function(){c.hide()},b.init=function(){n&&f.rCall("sc.get",[m]).then(function(a){b.configuration.identifier=m,b.configuration.callsign=a.spacecraft_callsign,b.configuration.savedTleId=a.spacecraft_tle_id})}}]),angular.module("snOperationsMap",["snMapServices","snMarkerModels","snGroundStationModels","snSpacecraftModels","snNetworkModels"]).controller("mapCtrl",["$log","$scope","mapServices","markers","gsModels","scModels","serverModels","ZOOM",function(a,b,c,d,e,f,g,h){b.defaults={zoomControlPosition:"bottomright"},b.center={zoom:h},b.markers={},b.layers={baselayers:{},overlays:{}},b.init=function(){b.map=d.configureMapScope(b),c.autocenterMap(b,h).then(function(){g.initStandalone().then(function(b){a.log("maps.js@init: Server ="+JSON.stringify(b)),e.initAll().then(function(b){a.log("maps.js@init: Ground Station(s) = "+JSON.stringify(b))})})}),f.initAll().then(function(b){a.log("maps.js@init: Spacecraft = "+JSON.stringify(b))}),e.initListeners(),f.initListeners()}}]).directive("snMap",function(){return{restrict:"E",templateUrl:"operations/templates/map.html"}}),angular.module("snOperationalDirective",["ngMaterial","snControllers","snJRPCServices","snTimelineServices"]).controller("snOperationalSchCtrl",["$scope","$log","satnetRPC","snDialog","SN_SCH_GS_ID_MAX_LENGTH","timeline",function(a,b,c,d,e,f){a.gui=null,a.createSlot=function(b,c){var d=moment(c.start).unix(),f=moment(c.end).unix(),g=d-a.gui.start_d_s,h=g/a.gui.total_s*100,i=f-d,j=i/a.gui.total_s*100,k=b.identifier+"";return{raw_slot:b,slot:{id:k.substring(e),s_date:moment(c.start).format(),e_date:moment(c.end).format(),left:h.toFixed(3),width:j.toFixed(3)}}},a.getGSSlots=function(a){return c.rCall("gs.operational",[a]).then(function(b){return{groundstation_id:a,slots:b}})["catch"](function(b){d.exception("gs.operational",a,b)})},a.init=function(){a.gui=f.initScope(),c.rCall("gs.list",[]).then(function(b){angular.forEach(b,function(b){a.getGSSlots(b).then(function(c){a.gui.slots[b]=f.filterSlots(a.gui,b,c.slots,a.createSlot)})})})["catch"](function(a){d.exception("gs.list",[],a)})}}]).directive("snOperationalScheduler",function(){return{restrict:"E",templateUrl:"operations/templates/operational/scheduler.html"}}).controller("snOperationalDlgCtrl",["$scope","$mdDialog",function(a,b){a.close=function(){b.hide()}}]).controller("snOperationalCtrl",["$scope","$mdDialog",function(a,b){a.openDialog=function(){b.show({templateUrl:"operations/templates/operational/dialog.html",controller:"snOperationalDlgCtrl"})}}]).directive("snOperational",function(){return{restrict:"E",templateUrl:"operations/templates/operational/menu.html"}}),angular.module("snOperationsDirective",["ngMaterial","ngAnimate","angular-loading-bar","leaflet-directive","snJRPCServices","snTimelineServices","snTimelineDirective","snLoggerDirective","snSplashDirective","snAboutDirective","snCompatibilityDirective","snAvailabilityDirective","snOperationalDirective","snRuleFilters","snLoggerFilters","snControllers","snOperationsMap","snOperationsMenuControllers","snGsControllers","snScControllers"]).config(function(a){a.theme("default").primaryPalette("blue-grey").accentPalette("grey")}).controller("operationsAppCtrl",function(a,b){a.toggleMenu=function(){b("menu").toggle()}}).directive("operationsApp",function(){return{restrict:"E",templateUrl:"operations/templates/app.html"}});